<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Fix The District</title>
    <meta name="theme-color" content="#00843D">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' fill='none' stroke='%23E32017' stroke-width='12'/><rect x='5' y='38' width='90' height='24' fill='%23003688'/><text x='50' y='54' font-family='Arial,sans-serif' font-size='10.5' fill='white' text-anchor='middle' font-weight='bold'>WIMBLEDON</text></svg>">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <header class="header">
        <div class="header-inner">
            <h1>Fix The District <span class="line-badge">WIMBLEDON</span></h1>
        </div>
    </header>

    <nav class="nav">
        <div class="nav-inner">
            <a href="index.html">Report</a>
            <a href="feed.html">Feed</a>
            <a href="dashboard.html" class="active">Dashboard</a>
        </div>
    </nav>

    <main class="container">

        <!-- Demo mode toggle -->
        <div class="demo-toggle-bar">
            <label class="demo-toggle-label" for="demo-toggle">
                <input type="checkbox" id="demo-toggle" onchange="toggleDemoMode()">
                <span>Show dummy data</span>
            </label>
        </div>
        <div id="demo-banner" class="demo-banner" style="display: none;">
            Viewing dummy data — not real reports
        </div>

        <!-- Time lost hero -->
        <div id="time-lost-hero" class="time-lost-hero">
            <div class="big-label">Loading...</div>
        </div>

        <!-- Stats grid -->
        <div id="stats-grid" class="stats-grid"></div>

        <!-- Time lost by week -->
        <div class="card">
            <div class="card-title">Time lost by week</div>
            <div id="weekly-chart" class="bar-chart"></div>
        </div>

        <!-- Time lost by month -->
        <div class="card">
            <div class="card-title">Time lost by month</div>
            <div id="monthly-chart" class="bar-chart"></div>
        </div>

        <!-- Reports by category -->
        <div class="card">
            <div class="card-title">Issues by category</div>
            <div id="category-chart" class="bar-chart"></div>
        </div>

        <!-- TfL discrepancy stats -->
        <div class="card">
            <div class="card-title">TfL status vs reality</div>
            <div id="discrepancy-stats"></div>
        </div>

        <!-- Reliability & patterns (toggleable) -->
        <div class="card">
            <button id="toggle-patterns-btn" class="toggle-btn" onclick="togglePatterns()">
                Show reliability &amp; patterns ▼
            </button>
            <div id="patterns-container" style="display: none;">
                <div style="margin-top: 16px;">
                    <div class="card-title">District line reliability — all branches (last 14 days)</div>
                    <div id="reliability-chart"></div>
                </div>
                <div style="margin-top: 20px;">
                    <div class="card-title">Wimbledon branch reliability (last 14 days)</div>
                    <div id="reliability-wimbledon-chart"></div>
                </div>
                <div id="reliability-summary"></div>
                <div style="margin-top: 24px;">
                    <div class="card-title">Reports by station</div>
                    <div id="station-chart" class="bar-chart"></div>
                </div>
                <div style="margin-top: 24px;">
                    <div class="card-title">Time lost by day of week</div>
                    <div id="day-of-week-chart"></div>
                </div>
                <div style="margin-top: 24px;">
                    <div class="card-title">Time lost by time of day</div>
                    <div id="time-of-day-chart"></div>
                </div>
            </div>
        </div>

        <!-- Lost Customer Hours context -->
        <div class="context-box">
            <h4>Why this data matters</h4>
            <p>TfL used to measure the impact of delays using a metric called <strong>Lost Customer Hours</strong> — estimating the total time lost by passengers due to disruptions of two minutes or more. However, TfL stopped publishing this data after 2019/20, citing COVID changes to passenger demand. They have never resumed it.</p>
            <p>With no official measure of real-world delay impact, this community tracker fills the gap. The "time lost" figures above use a similar principle — multiplying delay duration by the number of affected passengers — to produce evidence we can present to our MP, TfL, and the Department for Transport.</p>
            <p class="source">Source: <a href="https://tfl.gov.uk/corporate/publications-and-reports/underground-services-performance" target="_blank" rel="noopener" style="color: #3A5F8F;">TfL Underground Services Performance</a></p>
        </div>

    </main>

    <div class="site-footer">
        <div class="footer-section">
            <h4>What we hope to show</h4>
            <p>This project documents the real passenger experience on the Wimbledon branch and compares it against TfL's official status reports. We aim to demonstrate that TfL frequently reports "Good Service" while passengers experience significant delays — and use that evidence to push for investment.</p>
        </div>
        <div class="footer-section" style="text-align: center;">
            <p>Designed and built by a Southfields resident fed up of waiting. TfL status via <a href="https://tfl.gov.uk/info-for/open-data-users/our-open-data" target="_blank" rel="noopener">TfL Open Data</a>.</p>
            <p style="margin-top: 8px;"><a href="mailto:districtlinetracker@gmail.com?subject=Suggestion%20for%20Fix%20The%20District">Suggest an improvement or get in touch</a></p>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script src="js/demo-data.js"></script>
    <script src="js/app.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>
